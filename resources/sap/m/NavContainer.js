/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.m.NavContainer");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.m.NavContainer",{metadata:{publicMethods:["to","back","backToPage","backToTop","getPage","getCurrentPage","getPreviousPage","addCustomTransition"],library:"sap.m",properties:{"height":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"visible":{type:"boolean",group:"Appearance",defaultValue:true},"defaultTransitionName":{type:"string",group:"Appearance",defaultValue:"slide"}},defaultAggregation:"pages",aggregations:{"pages":{type:"sap.ui.core.Control",multiple:true,singularName:"page"}},associations:{"initialPage":{type:"sap.ui.core.Control",multiple:false}},events:{"navigate":{allowPreventDefault:true},"afterNavigate":{}}}});sap.m.NavContainer.M_EVENTS={'navigate':'navigate','afterNavigate':'afterNavigate'};
sap.m.NavContainer.prototype.init=function(){this._pageStack=[];this._mVisitedPages={};this._iTransitionsCompleted=0;this._bNeverRendered=true};
sap.m.NavContainer.prototype.onBeforeRendering=function(){if(this._bNeverRendered){var p=this.getCurrentPage();var a=p.getId();if(!this._mVisitedPages[a]){this._mVisitedPages[a]=true;var n={from:null,fromId:null,to:p,toId:a,firstTime:true,isTo:false,isBack:false,isBackToPage:false,isBackToTop:false,direction:"initial"};var e=jQuery.Event("BeforeFirstShow",n);e.srcControl=this;e.data={};e.backData={};p._handleEvent(e);e=jQuery.Event("BeforeShow",n);e.srcControl=this;e.data={};e.backData={};p._handleEvent(e)}}};
sap.m.NavContainer.prototype.onAfterRendering=function(){if(this._bNeverRendered){this._bNeverRendered=false;delete this._bNeverRendered;var p=this.getCurrentPage();var a=p.getId();var n={from:null,fromId:null,to:p,toId:a,firstTime:true,isTo:false,isBack:false,isBackToTop:false,isBackToPage:false,direction:"initial"};var e=jQuery.Event("AfterShow",n);e.srcControl=this;e.data={};e.backData={};p._handleEvent(e)}};
sap.m.NavContainer.prototype._getActualInitialPage=function(){var p=this.getInitialPage();if(p){var a=sap.ui.getCore().byId(p);if(a){return a}else{jQuery.sap.log.error("NavContainer: control with ID '"+p+"' was set as 'initialPage' but was not found as a DIRECT child of this NavContainer (number of current children: "+this.getPages().length+").")}}var b=this.getPages();return(b.length>0?b[0]:null)};
sap.m.NavContainer.prototype.getPage=function(p){var P=this.getPages();for(var i=0;i<P.length;i++){if(P[i]&&(P[i].getId()==p)){return P[i]}}return null};
sap.m.NavContainer.prototype._ensurePageStackInitialized=function(){if(this._pageStack.length===0){var p=this._getActualInitialPage();this._pageStack.push({id:p.getId(),mode:"initial",data:{}})}return this._pageStack};
sap.m.NavContainer.prototype.getCurrentPage=function(){var s=this._ensurePageStackInitialized();return this.getPage(s[s.length-1].id)};
sap.m.NavContainer.prototype.getPreviousPage=function(){var s=this._ensurePageStackInitialized();if(s.length>1){return this.getPage(s[s.length-2].id)}else if(s.length==1){return undefined}else{jQuery.sap.log.error("page stack is empty but should have been initialized")}};
sap.m.NavContainer.prototype._afterTransitionCallback=function(n,d,b){var e=jQuery.Event("AfterShow",n);e.data=d||{};e.backData=b||{};e.srcControl=this;n.to._handleEvent(e);e=jQuery.Event("AfterHide",n);e.srcControl=this;n.from._handleEvent(e);this.fireAfterNavigate(n);this._iTransitionsCompleted++;this._bNavigating=false};
sap.m.NavContainer.prototype.to=function(p,t,d,T){if(p instanceof sap.ui.core.Control){p=p.getId()}if(typeof(t)!=="string"){T=d;d=t}t=t||this.getDefaultTransitionName();T=T||{};d=d||{};this._ensurePageStackInitialized();var f=this.getCurrentPage();if(f&&(f.getId()===p)){jQuery.sap.log.warning(this.toString()+": Cannot navigate to page "+p+" because this is the current page.");return this}if(this._bNavigating){jQuery.sap.log.warning(this.toString()+": Cannot navigate to page "+p+" because another navigation is already in progress.");return this}var o=this.getPage(p);if(o){var n={from:f,fromId:f.getId(),to:o,toId:p,firstTime:!this._mVisitedPages[p],isTo:true,isBack:false,isBackToTop:false,isBackToPage:false,direction:"to"};var c=this.fireNavigate(n);if(c){var e=jQuery.Event("BeforeHide",n);e.srcControl=this;f._handleEvent(e);if(!this._mVisitedPages[p]){e=jQuery.Event("BeforeFirstShow",n);e.srcControl=this;e.data=d||{};e.backData={};o._handleEvent(e)}e=jQuery.Event("BeforeShow",n);e.srcControl=this;e.data=d||{};e.backData={};o._handleEvent(e);this._pageStack.push({id:p,mode:t,data:d});this._mVisitedPages[p]=true;if(!this.getDomRef()){jQuery.sap.log.info("'Hidden' 'to' navigation in not-rendered NavContainer "+this.toString());return this}var a;if(!(a=o.getDomRef())||sap.ui.core.RenderManager.isPreservedContent(a)){o.addStyleClass("sapMNavItemRendering",true);jQuery.sap.log.debug("Rendering 'to' page '"+o.toString()+"' for 'to' navigation");var r=sap.ui.getCore().createRenderManager();r.render(o,this.getDomRef());r.destroy();o.addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemRendering",true)}var b=sap.m.NavContainer.transitions[t]||sap.m.NavContainer.transitions["slide"];var C=this._iTransitionsCompleted;var g=this;window.setTimeout(function(){if(g&&(g._iTransitionsCompleted<C+1)){jQuery.sap.log.warning("Transition '"+t+"' 'to' was triggered five seconds ago, but has not yet invoked the end-of-transition callback.")}},5000);this._bNavigating=true;b.to(f,o,jQuery.proxy(function(){this._afterTransitionCallback(n,d)},this),T)}else{jQuery.sap.log.info("Navigation to page with ID '"+p+"' has been aborted by the application")}}else{jQuery.sap.log.warning("Navigation triggered to page with ID '"+p+"', but this page is not known/aggregated by "+this)}return this};
sap.m.NavContainer.prototype.back=function(b,t){this._backTo("back",b,t);return this};
sap.m.NavContainer.prototype.backToPage=function(p,b,t){this._backTo("backToPage",b,t,p);return this};
sap.m.NavContainer.prototype.backToTop=function(b,t){this._backTo("backToTop",b,t);return this};
sap.m.NavContainer.prototype._backTo=function(t,b,T,r){if(this._pageStack.length<=1){if(this._pageStack.length===1&&this._pageStack[0].mode!="initial"){throw new Error("Initial page not found on the stack. How did this happen?")}return this}else{if(this._bNavigating){jQuery.sap.log.warning(this.toString()+": Cannot navigate back because another navigation is already in progress.");return this}var f=this._pageStack[this._pageStack.length-1];var m=f.mode;var F=this.getPage(f.id);var o;var a;if(t==="backToTop"){o=this._getActualInitialPage();a=null}else if(t==="backToPage"){var i=this._findClosestPreviousPageInfo(r);if(!i){jQuery.sap.log.error(this.toString()+": Cannot navigate backToPage('"+r+"') because target page was not found among the previous pages.");return this}o=sap.ui.getCore().byId(i.id);if(!o){jQuery.sap.log.error(this.toString()+": Cannot navigate backToPage('"+r+"') because target page does not exist anymore.");return this}a=i.data}else{o=this.getPreviousPage();a=this._pageStack[this._pageStack.length-2].data}if(!o){jQuery.sap.log.error("NavContainer back navigation: target page is not defined or not aggregated by this NavContainer. Aborting navigation.");return}var c=o.getId();b=b||{};T=T||{};var n={from:F,fromId:F.getId(),to:o,toId:c,firstTime:!this._mVisitedPages[c],isTo:false,isBack:(t==="back"),isBackToPage:(t==="backToPage"),isBackToTop:(t==="backToTop"),direction:t};var C=this.fireNavigate(n);if(C){var e=jQuery.Event("BeforeHide",n);e.srcControl=this;F._handleEvent(e);if(!this._mVisitedPages[c]){e=jQuery.Event("BeforeFirstShow",n);e.srcControl=this;e.backData=b||{};e.data={};o._handleEvent(e)}e=jQuery.Event("BeforeShow",n);e.srcControl=this;e.backData=b||{};e.data=a||{};o._handleEvent(e);this._pageStack.pop();this._mVisitedPages[c]=true;if(t==="backToTop"){this._pageStack=[];this.getCurrentPage()}else if(t==="backToPage"){while(this._pageStack[this._pageStack.length-1].id!==r){this._pageStack.pop()}}if(!this.getDomRef()){jQuery.sap.log.info("'Hidden' back navigation in not-rendered NavContainer "+this.toString());return this}var d=sap.m.NavContainer.transitions[m]||sap.m.NavContainer.transitions["slide"];var g=this._iTransitionsCompleted;var h=this;window.setTimeout(function(){if(h&&(h._iTransitionsCompleted<g+1)){jQuery.sap.log.warning("Transition '"+m+"' 'back' was triggered five seconds ago, but has not yet invoked the end-of-transition callback.")}},5000);this._bNavigating=true;var j;if(!(j=o.getDomRef())||sap.ui.core.RenderManager.isPreservedContent(j)){o.addStyleClass("sapMNavItemRendering",true);jQuery.sap.log.debug("Rendering 'to' page '"+o.toString()+"' for back navigation");var k=sap.ui.getCore().createRenderManager();var l=this.$().children().index(F.getDomRef());k.renderControl(o);k.flush(this.getDomRef(),false,l);k.destroy();o.addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemRendering",true)}d.back(F,o,jQuery.proxy(function(){this._afterTransitionCallback(n,a,b)},this),T)}}return this};
sap.m.NavContainer.prototype._findClosestPreviousPageInfo=function(r){for(var i=this._pageStack.length-2;i>=0;i--){var a=this._pageStack[i];if(a.id===r){return a}}return null};
sap.m.NavContainer.transitions=sap.m.NavContainer.transitions||{};sap.m.NavContainer.transitions["show"]={to:function(f,t,c){t.removeStyleClass("sapMNavItemHidden",true);f.addStyleClass("sapMNavItemHidden",true);c()},back:function(f,t,c){t.removeStyleClass("sapMNavItemHidden",true);f.addStyleClass("sapMNavItemHidden",true);c()}};sap.m.NavContainer.transitions["slide"]={to:function(f,t,c){t.addStyleClass("sapMNavItemRight",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var o=false;var a=null;a=function(){if(!o){o=true}else{f.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.removeStyleClass("sapMNavItemSliding",true);f.removeStyleClass("sapMNavItemSliding",true).addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemLeft",true);c()}};f.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.addStyleClass("sapMNavItemSliding",true).removeStyleClass("sapMNavItemRight",true);f.addStyleClass("sapMNavItemSliding",true).addStyleClass("sapMNavItemLeft",true)},60)},back:function(f,t,c){t.addStyleClass("sapMNavItemLeft",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var o=false;var a=null;a=function(){if(!o){o=true}else{f.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.removeStyleClass("sapMNavItemSliding",true);f.removeStyleClass("sapMNavItemSliding",true).addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemRight",true);c()}};f.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.addStyleClass("sapMNavItemSliding",true).removeStyleClass("sapMNavItemLeft",true);f.addStyleClass("sapMNavItemSliding",true).addStyleClass("sapMNavItemRight",true)},100)}};sap.m.NavContainer.transitions["fade"]={to:function(f,t,c){t.addStyleClass("sapMNavItemTransparent",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var a=null;a=function(){t.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);f.addStyleClass("sapMNavItemHidden",true);t.removeStyleClass("sapMNavItemFading",true).removeStyleClass("sapMNavItemOpaque",true);c()};t.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.addStyleClass("sapMNavItemFading",true).removeStyleClass("sapMNavItemTransparent",true).addStyleClass("sapMNavItemOpaque")},10)},back:function(f,t,c){f.addStyleClass("sapMNavItemOpaque",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var a=null;a=function(){f.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);f.removeStyleClass("sapMNavItemFading",true).addStyleClass("sapMNavItemHidden",true);f.removeStyleClass("sapMNavItemTransparent",true);c()};f.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);f.addStyleClass("sapMNavItemFading",true).removeStyleClass("sapMNavItemOpaque",true);f.addStyleClass("sapMNavItemTransparent",true)},10)}};sap.m.NavContainer.transitions["flip"]={to:function(f,t,c){t.addStyleClass("sapMNavItemFlipNext",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var o=false;var a=null;a=function(){if(!o){o=true}else{f.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.removeStyleClass("sapMNavItemFlipping",true);f.removeStyleClass("sapMNavItemFlipping",true).addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemFlipPrevious",true);c()}};f.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.addStyleClass("sapMNavItemFlipping",true).removeStyleClass("sapMNavItemFlipNext",true);f.addStyleClass("sapMNavItemFlipping",true).addStyleClass("sapMNavItemFlipPrevious",true)},60)},back:function(f,t,c){t.addStyleClass("sapMNavItemFlipPrevious",true);t.removeStyleClass("sapMNavItemHidden",true);window.setTimeout(function(){var o=false;var a=null;a=function(){if(!o){o=true}else{f.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.detachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.removeStyleClass("sapMNavItemFlipping",true);f.removeStyleClass("sapMNavItemFlipping",true).addStyleClass("sapMNavItemHidden",true).removeStyleClass("sapMNavItemFlipNext",true);c()}};f.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.attachBrowserEvent("webkitTransitionEnd transitionend msTransitionEnd",a);t.addStyleClass("sapMNavItemFlipping",true).removeStyleClass("sapMNavItemFlipPrevious",true);f.addStyleClass("sapMNavItemFlipping",true).addStyleClass("sapMNavItemFlipNext",true)},60)}};
sap.m.NavContainer.prototype.addCustomTransition=function(n,t,b){if(sap.m.NavContainer.transitions[n]){jQuery.sap.log.warning("Transition with name "+n+" already exists in "+this+". It is now being replaced by custom transition.")}sap.m.NavContainer.transitions[n]={to:t,back:b};return this};
sap.m.NavContainer.addCustomTransition=sap.m.NavContainer.prototype.addCustomTransition;sap.m.NavContainer.prototype.forceInvalidation=sap.m.NavContainer.prototype.invalidate;
sap.m.NavContainer.prototype.invalidate=function(s){if(s==this){}else if(!s){this.forceInvalidation()}else if(s instanceof sap.ui.core.Control){var I=false,p=this.getPages(),l=p.length;for(var i=0;i<l;i++){if(p[i]===s){I=true;break}}if(I&&!(s.getId()===this.getCurrentPage())){}else{this.forceInvalidation()}}else{this.forceInvalidation()}};
sap.m.NavContainer.prototype.addPage=function(p){p.addStyleClass("sapMNavItem");this.addAggregation("pages",p,true);return this};
sap.m.NavContainer.prototype.insertPage=function(p,i){p.addStyleClass("sapMNavItem");this.insertAggregation("pages",p,true);return this};
